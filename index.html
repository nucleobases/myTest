<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>薪資試算工具｜Payroll 計算頁</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+TC:wght@300;400;500;600;700&family=Noto+Serif+TC:wght@600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js" defer></script>
  <style>
    :root {
      color-scheme: light;
      --ink: #231f1a;
      --muted: #6b5f53;
      --paper: #f7f0e8;
      --cream: #fff8f1;
      --accent: #c65c2c;
      --accent-deep: #8f3a1f;
      --teal: #2f7f7b;
      --lime: #c9d58c;
      --shadow: rgba(35, 31, 26, 0.12);
      --border: rgba(35, 31, 26, 0.12);
      --warning: #e6a34a;
      --error: #d1493b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "IBM Plex Sans TC", sans-serif;
      color: var(--ink);
      background: radial-gradient(circle at 15% 10%, #ffe7d3 0%, #fef7ef 35%, #f4ece1 100%);
      min-height: 100vh;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(120deg, rgba(198, 92, 44, 0.16), transparent 55%),
        radial-gradient(circle at 80% 20%, rgba(47, 127, 123, 0.12), transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    .calc {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 20px 80px;
    }

    .calc__header {
      display: grid;
      gap: 18px;
      margin-bottom: 28px;
    }

    .calc__title {
      font-family: "Noto Serif TC", serif;
      font-size: 32px;
      margin: 0;
    }

    .calc__subtitle {
      margin: 6px 0 0;
      color: var(--muted);
      max-width: 680px;
    }

    .chip-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .chip {
      border-radius: 999px;
      padding: 6px 14px;
      background: rgba(47, 127, 123, 0.12);
      color: var(--teal);
      font-size: 12px;
      font-weight: 600;
    }

    .calc__main {
      display: grid;
      gap: 28px;
    }

    .calc-section {
      background: rgba(255, 255, 255, 0.86);
      border: 1px solid var(--border);
      border-radius: 22px;
      padding: 24px;
      box-shadow: 0 18px 32px -26px var(--shadow);
    }

    .calc-section__header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    .calc-section__title {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
    }

    .calc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
    }

    .calc-stack {
      display: grid;
      gap: 18px;
    }

    .card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 18px 20px;
      box-shadow: 0 16px 28px -24px var(--shadow);
    }

    .card__title {
      font-weight: 700;
      margin-bottom: 12px;
    }

    .card__body {
      color: var(--ink);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 14px;
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-label {
      font-size: 13px;
      font-weight: 600;
    }

    .form-input {
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 10px 12px;
      font-size: 14px;
      font-family: inherit;
      background: #fff;
      color: var(--ink);
    }

    .form-input:focus {
      outline: 2px solid rgba(198, 92, 44, 0.35);
      border-color: rgba(198, 92, 44, 0.35);
    }

    .form-hint {
      font-size: 12px;
      color: var(--muted);
    }

    .form-error {
      font-size: 12px;
      color: var(--error);
      min-height: 16px;
    }

    .form-error--hidden {
      visibility: hidden;
    }

    .radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 13px;
      font-weight: 600;
      color: var(--ink);
    }

    .calc-list {
      display: grid;
      gap: 8px;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .calc-list__item {
      padding: 8px 12px;
      border-radius: 12px;
      background: rgba(47, 127, 123, 0.08);
      font-size: 13px;
    }

    .calc-list__item--muted {
      background: rgba(35, 31, 26, 0.06);
      color: var(--muted);
    }

    .calc-list__item--alert {
      background: rgba(209, 73, 59, 0.12);
      color: var(--error);
      font-weight: 600;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .table th,
    .table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      text-align: left;
      vertical-align: top;
    }

    .table th {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      color: var(--muted);
    }

    .grade-table__row--active {
      background: rgba(198, 92, 44, 0.12);
      border-left: 3px solid var(--accent);
    }

    .split-card {
      display: grid;
      gap: 12px;
      font-size: 13px;
    }

    .split-card__line {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      font-weight: 600;
    }

    .split-card__line span:last-child {
      font-variant-numeric: tabular-nums;
    }

    .split-card__note {
      color: var(--muted);
      font-size: 12px;
    }

    .summary-highlight {
      background: rgba(198, 92, 44, 0.12);
      color: var(--accent-deep);
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 700;
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }

    .is-hidden {
      display: none;
    }

    @media (max-width: 720px) {
      .calc-section {
        padding: 18px;
      }

      .calc__title {
        font-size: 26px;
      }
    }
  </style>
</head>
<body>
  <div class="calc">
    <header class="calc__header">
      <div>
        <h1 class="calc__title">薪資試算工具</h1>
        <p class="calc__subtitle">依照薪資結構、出勤比例與保險級距即時計算薪資，並同步顯示員工薪資條與公司負擔費用。</p>
      </div>
      <div class="chip-group">
        <span class="chip">基本工資 28,590</span>
        <span class="chip">勞保費率 12.5%</span>
        <span class="chip">健保費率 5.17%</span>
        <span class="chip">計薪月份：每月 30 天</span>
        <span class="chip">加班倍數：1.34 / 1.67 / 2.00</span>
      </div>
    </header>

    <main class="calc__main">
      <section class="calc-section" id="salary-structure">
        <div class="calc-section__header">
          <h2 class="calc-section__title">薪資結構</h2>
          <div class="chip-group">
            <span class="chip">本薪 + 津貼項目</span>
            <span class="chip">調整需覆核</span>
          </div>
        </div>
        <div class="calc-grid">
          <div class="card">
            <div class="card__title">薪資結構輸入</div>
            <form class="form-grid" id="salaryForm" novalidate>
              <label class="form-field">
                <span class="form-label">身分別</span>
                <select class="form-input" id="employmentTypeSelect">
                  <option value="monthly" selected>月薪</option>
                  <option value="hourly">時薪</option>
                </select>
                <span class="form-hint">月薪 / 時薪</span>
                <div class="form-error form-error--hidden" id="employmentTypeSelectError"></div>
              </label>
              <label class="form-field">
                <span class="form-label" id="baseSalaryLabel">本薪</span>
                <input class="form-input" id="baseSalaryInput" type="number" min="0" step="100" value="0" />
                <span class="form-hint" id="baseSalaryHint">作為薪資計算基礎</span>
                <div class="form-error form-error--hidden" id="baseSalaryInputError"></div>
              </label>
              <label class="form-field">
                <span class="form-label">伙食費</span>
                <input class="form-input" id="mealAllowanceInput" type="number" min="0" step="100" value="3000" />
                <span class="form-hint">津貼項目</span>
                <div class="form-error form-error--hidden" id="mealAllowanceInputError"></div>
              </label>
              <label class="form-field">
                <span class="form-label">主管津貼</span>
                <input class="form-input" id="supervisorAllowanceInput" type="number" min="0" step="100" value="0" />
                <span class="form-hint">津貼項目</span>
                <div class="form-error form-error--hidden" id="supervisorAllowanceInputError"></div>
              </label>
              <label class="form-field">
                <span class="form-label">專業津貼</span>
                <input class="form-input" id="professionalAllowanceInput" type="number" min="0" step="100" value="0" />
                <span class="form-hint">津貼項目</span>
                <div class="form-error form-error--hidden" id="professionalAllowanceInputError"></div>
              </label>
              <label class="form-field">
                <span class="form-label">交通津貼</span>
                <input class="form-input" id="transportAllowanceInput" type="number" min="0" step="100" value="0" />
                <span class="form-hint">津貼項目</span>
                <div class="form-error form-error--hidden" id="transportAllowanceInputError"></div>
              </label>
              <label class="form-field">
                <span class="form-label">眷屬數</span>
                <select class="form-input" id="dependentsSelect">
                  <option value="0" selected>0 人</option>
                  <option value="1">1 人</option>
                  <option value="2">2 人</option>
                  <option value="3">3 人</option>
                </select>
                <span class="form-hint">健保倍數最多 3 人</span>
                <div class="form-error form-error--hidden" id="dependentsSelectError"></div>
              </label>
            </form>
          </div>
          <div class="card">
            <div class="card__title">薪資計算過程</div>
            <div class="card__body" id="salaryProcess"></div>
          </div>
        </div>
      </section>

      <section class="calc-section" id="attendance">
        <div class="calc-section__header">
          <h2 class="calc-section__title">出勤資料</h2>
          <div class="chip-group">
            <span class="chip">月計薪 30 天</span>
            <span class="chip">加班時數可試算</span>
          </div>
        </div>
        <div class="calc-grid">
          <div class="card">
            <div class="card__title">出勤狀態與日期</div>
            <div class="form-grid">
              <div class="form-field">
                <span class="form-label">狀態</span>
                <div class="radio-group" id="attendanceStatusGroup">
                  <label class="radio-option">
                    <input type="radio" name="attendanceStatus" value="entry" />
                    入職
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="attendanceStatus" value="active" checked />
                    在職
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="attendanceStatus" value="exit" />
                    離職
                  </label>
                </div>
                <div class="form-error form-error--hidden" id="attendanceStatusError"></div>
              </div>
              <label class="form-field is-hidden" id="entryDateField">
                <span class="form-label">入職日期</span>
                <input class="form-input" id="entryDateInput" type="date" />
                <span class="form-hint">非第一天將按比例計薪</span>
                <div class="form-error form-error--hidden" id="entryDateInputError"></div>
              </label>
              <label class="form-field is-hidden" id="exitDateField">
                <span class="form-label">離職日期</span>
                <input class="form-input" id="exitDateInput" type="date" />
                <span class="form-hint">以離職日比例計薪</span>
                <div class="form-error form-error--hidden" id="exitDateInputError"></div>
              </label>
              <label class="form-field">
                <span class="form-label">加班 1.34 倍時數</span>
                <input class="form-input" id="overtimeHours134Input" type="number" min="0" step="0.5" value="0" />
                <span class="form-hint">以 1.34 倍計薪（支援 0.5 小時）</span>
                <div class="form-error form-error--hidden" id="overtimeHours134InputError"></div>
              </label>
              <label class="form-field">
                <span class="form-label">加班 1.67 倍時數</span>
                <input class="form-input" id="overtimeHours167Input" type="number" min="0" step="0.5" value="0" />
                <span class="form-hint">以 1.67 倍計薪（支援 0.5 小時）</span>
                <div class="form-error form-error--hidden" id="overtimeHours167InputError"></div>
              </label>
              <label class="form-field">
                <span class="form-label">加班 2.00 倍時數</span>
                <input class="form-input" id="overtimeHours200Input" type="number" min="0" step="0.5" value="0" />
                <span class="form-hint">以 2.00 倍計薪（支援 0.5 小時）</span>
                <div class="form-error form-error--hidden" id="overtimeHours200InputError"></div>
              </label>
            </div>
          </div>
          <div class="card">
            <div class="card__title">出勤比例計算</div>
            <div class="card__body" id="attendanceProcess"></div>
          </div>
        </div>
      </section>

      <section class="calc-section" id="settlement">
        <div class="calc-section__header">
          <h2 class="calc-section__title">薪資結算</h2>
          <div class="summary-highlight" id="netSalaryHighlight">實領薪資：—</div>
        </div>
        <div class="calc-grid">
          <div class="card">
            <div class="card__title">員工薪資條</div>
            <div class="card__body" id="employeePayslip"></div>
          </div>
          <div class="card">
            <div class="card__title">公司負擔費用</div>
            <div class="card__body" id="companyCost"></div>
          </div>
        </div>
        <div class="card" id="insuranceMatchCard">
          <div class="card__title">對應勞/健保級距</div>
          <div class="card__body" id="insuranceMatch"></div>
        </div>
      </section>

      <section class="calc-section" id="insurance-grade-table">
        <div class="calc-section__header">
          <h2 class="calc-section__title">勞 / 健保級距對照表</h2>
          <div class="chip-group">
            <span class="chip">顯示各級距金額與比例</span>
            <span class="chip" id="insuranceDaysChip">勞保投保日數：30 / 30</span>
            <span class="chip" id="dependentsChip">健保倍數：1 + 0 人</span>
          </div>
        </div>
        <div class="calc-stack">
          <div class="card">
            <div class="card__title">勞保投保薪資級距</div>
            <table class="table">
              <thead>
                <tr>
                  <th>級距代碼</th>
                  <th>薪資區間</th>
                  <th>投保薪資</th>
                  <th>勞保（員工 / 雇主）</th>
                </tr>
              </thead>
              <tbody id="laborGradeTableBody"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card__title">健保投保薪資級距</div>
            <table class="table">
              <thead>
                <tr>
                  <th>級距代碼</th>
                  <th>薪資區間</th>
                  <th>投保薪資</th>
                  <th>健保（員工 / 雇主）</th>
                </tr>
              </thead>
              <tbody id="healthGradeTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const numberFormatter = new Intl.NumberFormat("zh-Hant-TW");
    const currencyFormatter = new Intl.NumberFormat("zh-Hant-TW", {
      style: "currency",
      currency: "TWD",
      maximumFractionDigits: 0
    });
    const decimalFormatter = new Intl.NumberFormat("zh-Hant-TW", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
    const hourFormatter = new Intl.NumberFormat("zh-Hant-TW", {
      minimumFractionDigits: 0,
      maximumFractionDigits: 1
    });
    const config = {
      minWage: 28590,
      laborRate: 0.125,
      laborShare: { employee: 0.2, employer: 0.7, government: 0.1 },
      healthRate: 0.0517,
      healthShare: { employee: 0.3, employer: 0.6, government: 0.1 },
      healthEmployerMultiplier: 1.56,
      pensionEmployerRate: 0.06
    };
    const laborGrades = [
      { code: "L01", min: 0, max: 29500, insured: 29500 },
      { code: "L02", min: 28801, max: 30300, insured: 30300 },
      { code: "L03", min: 30301, max: 31800, insured: 31800 },
      { code: "L04", min: 31801, max: 33300, insured: 33300 },
      { code: "L05", min: 33301, max: 34800, insured: 34800 },
      { code: "L06", min: 34801, max: 36300, insured: 36300 },
      { code: "L07", min: 36301, max: 38200, insured: 38200 },
      { code: "L08", min: 38201, max: 40100, insured: 40100 },
      { code: "L09", min: 40101, max: 42000, insured: 42000 },
      { code: "L10", min: 42001, max: 43900, insured: 43900 },
      { code: "L11", min: 43901, max: null, insured: 45800 }
    ];
    const healthGrades = [
      { code: "H01", min: 0, max: 29500, insured: 29500 },
      { code: "H02", min: 29501, max: 30300, insured: 30300 },
      { code: "H03", min: 30301, max: 31800, insured: 31800 },
      { code: "H04", min: 31801, max: 33300, insured: 33300 },
      { code: "H05", min: 33301, max: 34800, insured: 34800 },
      { code: "H06", min: 34801, max: 36300, insured: 36300 },
      { code: "H07", min: 36301, max: 38200, insured: 38200 },
      { code: "H08", min: 38201, max: 40100, insured: 40100 },
      { code: "H09", min: 40101, max: 42000, insured: 42000 },
      { code: "H10", min: 42001, max: 43900, insured: 43900 },
      { code: "H11", min: 43901, max: 45800, insured: 45800 },
      { code: "H12", min: 45801, max: 48200, insured: 48200 },
      { code: "H13", min: 48201, max: 50600, insured: 50600 },
      { code: "H14", min: 50601, max: 53000, insured: 53000 },
      { code: "H15", min: 53001, max: 55400, insured: 55400 },
      { code: "H16", min: 55401, max: 57800, insured: 57800 },
      { code: "H17", min: 57801, max: 60800, insured: 60800 },
      { code: "H18", min: 60801, max: 63800, insured: 63800 },
      { code: "H19", min: 63801, max: 66800, insured: 66800 },
      { code: "H20", min: 66801, max: 69800, insured: 69800 },
      { code: "H21", min: 69801, max: 72800, insured: 72800 },
      { code: "H22", min: 72801, max: 76500, insured: 76500 },
      { code: "H23", min: 76501, max: 80200, insured: 80200 },
      { code: "H24", min: 80201, max: 83900, insured: 83900 },
      { code: "H25", min: 83901, max: 87600, insured: 87600 },
      { code: "H26", min: 87601, max: 92100, insured: 92100 },
      { code: "H27", min: 92101, max: 96600, insured: 96600 },
      { code: "H28", min: 96601, max: 101100, insured: 101100 },
      { code: "H29", min: 101101, max: 105600, insured: 105600 },
      { code: "H30", min: 105601, max: 110100, insured: 110100 },
      { code: "H31", min: 110101, max: 115500, insured: 115500 },
      { code: "H32", min: 115501, max: 120900, insured: 120900 },
      { code: "H33", min: 120901, max: 126300, insured: 126300 },
      { code: "H34", min: 126301, max: 131700, insured: 131700 },
      { code: "H35", min: 131701, max: 137100, insured: 137100 },
      { code: "H36", min: 137101, max: 142500, insured: 142500 },
      { code: "H37", min: 142501, max: 147900, insured: 147900 },
      { code: "H38", min: 147901, max: 150000, insured: 150000 },
      { code: "H39", min: 150001, max: 156400, insured: 156400 },
      { code: "H40", min: 156401, max: 162800, insured: 162800 },
      { code: "H41", min: 162801, max: 169200, insured: 169200 },
      { code: "H42", min: 169201, max: 175600, insured: 175600 },
      { code: "H43", min: 175601, max: 182000, insured: 182000 },
      { code: "H44", min: 182001, max: 189500, insured: 189500 },
      { code: "H45", min: 189501, max: 197000, insured: 197000 },
      { code: "H46", min: 197001, max: 204500, insured: 204500 },
      { code: "H47", min: 204501, max: 212000, insured: 212000 },
      { code: "H48", min: 212001, max: 219500, insured: 219500 },
      { code: "H49", min: 219501, max: 228200, insured: 228200 },
      { code: "H50", min: 228201, max: 236900, insured: 236900 },
      { code: "H51", min: 236901, max: 245600, insured: 245600 },
      { code: "H52", min: 245601, max: 254300, insured: 254300 },
      { code: "H53", min: 254301, max: 263000, insured: 263000 },
      { code: "H54", min: 263001, max: 273000, insured: 273000 },
      { code: "H55", min: 273001, max: 283000, insured: 283000 },
      { code: "H56", min: 283001, max: 293000, insured: 293000 },
      { code: "H57", min: 293001, max: 303000, insured: 303000 },
      { code: "H58", min: 303001, max: null, insured: 313000 }
    ];
    /**
     * Format a number as currency.
     * @param {number} value
     * @returns {string}
     */
    const formatCurrency = (value) => currencyFormatter.format(Math.round(Number(value) || 0));

    /**
     * Format a number with thousand separators.
     * @param {number} value
     * @returns {string}
     */
    const formatNumber = (value) => numberFormatter.format(Math.round(Number(value) || 0));

    /**
     * Format hour value with optional half-hour precision.
     * @param {number} value
     * @returns {string}
     */
    const formatHour = (value) => hourFormatter.format(Number(value) || 0);

    /**
     * Format a number with fixed decimals.
     * @param {number} value
     * @returns {string}
     */
    const formatDecimal = (value) => decimalFormatter.format(Number(value) || 0);

    /**
     * Format a decimal rate as percent text.
     * @param {number} value
     * @param {number} digits
     * @returns {string}
     */
    const formatPercent = (value, digits = 2) => `${(Number(value) * 100).toFixed(digits)}%`;

    /**
     * Format a grade range for display.
     * @param {number} min
     * @param {number|null} max
     * @returns {string}
     */
    const formatRange = (min, max) => {
      if (max === null || max === undefined) {
        return `${formatCurrency(min)} 以上`;
      }
      if (min <= 0) {
        return `${formatCurrency(max)} 以下`;
      }
      return `${formatCurrency(min)} ~ ${formatCurrency(max)}`;
    };

    /**
     * Parse numeric input value.
     * @param {string} value
     * @returns {number}
     */
    const parseNumberInput = (value) => {
      const parsed = Number(value);
      return Number.isFinite(parsed) ? parsed : NaN;
    };

    /**
     * Show or hide field error message.
     * @param {string} fieldId
     * @param {string} message
     * @returns {void}
     */
    const setFieldError = (fieldId, message) => {
      const errorEl = document.getElementById(`${fieldId}Error`);
      if (!errorEl) {
        return;
      }
      if (!message) {
        errorEl.textContent = "";
        errorEl.classList.add("form-error--hidden");
        return;
      }
      errorEl.textContent = message;
      errorEl.classList.remove("form-error--hidden");
    };

    /**
     * Validate a numeric field and update error message.
     * @param {string} fieldId
     * @param {{required?: boolean, min?: number, max?: number, integer?: boolean, step?: number, label?: string}} options
     * @returns {{value: number, isValid: boolean, hasValue: boolean}}
     */
    const validateNumberField = (fieldId, options = {}) => {
      const input = document.getElementById(fieldId);
      if (!input) {
        return { value: 0, isValid: false, hasValue: false };
      }
      const raw = input.value.trim();
      const hasValue = raw !== "";
      if (!hasValue) {
        if (options.required) {
          setFieldError(fieldId, `請輸入${options.label || "數值"}`);
          return { value: 0, isValid: false, hasValue };
        }
        setFieldError(fieldId, "");
        return { value: 0, isValid: !options.required, hasValue };
      }
      const value = parseNumberInput(raw);
      if (!Number.isFinite(value)) {
        setFieldError(fieldId, "請輸入數字");
        return { value: 0, isValid: false, hasValue };
      }
      if (options.integer && !Number.isInteger(value)) {
        setFieldError(fieldId, "請輸入整數");
        return { value: 0, isValid: false, hasValue };
      }
      if (Number.isFinite(options.min) && value < options.min) {
        setFieldError(fieldId, `${options.label || "數值"}不得低於 ${formatNumber(options.min)}`);
        return { value: 0, isValid: false, hasValue };
      }
      if (Number.isFinite(options.max) && value > options.max) {
        setFieldError(fieldId, `${options.label || "數值"}不得高於 ${formatNumber(options.max)}`);
        return { value: 0, isValid: false, hasValue };
      }
      if (Number.isFinite(options.step) && options.step > 0) {
        const factor = 1 / options.step;
        const scaled = value * factor;
        if (Math.abs(scaled - Math.round(scaled)) > 1e-8) {
          setFieldError(fieldId, `請輸入 ${options.step} 的倍數`);
          return { value: 0, isValid: false, hasValue };
        }
      }
      setFieldError(fieldId, "");
      return { value, isValid: true, hasValue };
    };

    /**
     * Validate a date field with 30-day month rule.
     * @param {string} fieldId
     * @param {{required?: boolean}} options
     * @returns {{value: string, day: number, isValid: boolean, hasValue: boolean}}
     */
    const validateDateField = (fieldId, options = {}) => {
      const input = document.getElementById(fieldId);
      if (!input) {
        return { value: "", day: 0, isValid: false, hasValue: false };
      }
      const raw = input.value.trim();
      const hasValue = raw !== "";
      if (!hasValue) {
        if (options.required) {
          setFieldError(fieldId, "請輸入日期");
          return { value: "", day: 0, isValid: false, hasValue };
        }
        setFieldError(fieldId, "");
        return { value: "", day: 0, isValid: !options.required, hasValue };
      }
      const date = dayjs(raw, "YYYY-MM-DD", true);
      if (!date.isValid()) {
        setFieldError(fieldId, "日期格式錯誤");
        return { value: raw, day: 0, isValid: false, hasValue };
      }
      const day = date.date();
      setFieldError(fieldId, "");
      return { value: raw, day, isValid: true, hasValue };
    };

    /**
     * Get selected employment type.
     * @returns {"monthly"|"hourly"}
     */
    const getEmploymentType = () => {
      const select = document.getElementById("employmentTypeSelect");
      return select?.value === "hourly" ? "hourly" : "monthly";
    };

    /**
     * Get selected attendance status.
     * @returns {"entry"|"active"|"exit"}
     */
    const getAttendanceStatus = () => {
      const selected = document.querySelector("input[name=\"attendanceStatus\"]:checked");
      return selected?.value || "active";
    };

    /**
     * Calculate hourly rate by employment type.
     * @param {"monthly"|"hourly"} employmentType
     * @param {number} baseSalary
     * @returns {number}
     */
    const getHourlyRate = (employmentType, baseSalary) => {
      if (employmentType === "hourly") {
        return baseSalary;
      }
      return baseSalary / 30 / 8;
    };

    /**
     * Calculate overtime pay based on overtime hours by multiplier.
     * @param {number} hourlyRate
     * @param {number} overtime134Hours
     * @param {number} overtime167Hours
     * @param {number} overtime200Hours
     * @returns {number}
     */
    const calculateOvertimePay = (hourlyRate, overtime134Hours, overtime167Hours, overtime200Hours) => {
      const hours134 = Math.max(0, Number(overtime134Hours) || 0);
      const hours167 = Math.max(0, Number(overtime167Hours) || 0);
      const hours200 = Math.max(0, Number(overtime200Hours) || 0);
      const total = (hours134 * 1.34 + hours167 * 1.67 + hours200 * 2) * hourlyRate;
      return Math.round(total);
    };

    /**
     * Calculate attendance ratio and description.
     * @param {"entry"|"active"|"exit"} status
     * @param {{day: number, isValid: boolean, hasValue: boolean}} entryDate
     * @param {{day: number, isValid: boolean, hasValue: boolean}} exitDate
     * @returns {{workDays: number, ratio: number, summary: string[], note: string}}
     */
    const calculateAttendanceInfo = (status, entryDate, exitDate) => {
      const summary = [];
      let workDays = 30;
      let ratio = 1;
      let note = "在職：工作天數 = 30 天，比例 = 30 / 30 = 1.00";
      if (status === "entry") {
        if (!entryDate.isValid) {
          summary.push("請輸入正確的入職日期，以計算出勤比例。");
          return { workDays: 30, ratio: 1, summary, note: "入職日期未完成" };
        }
        const entryDay = Math.min(entryDate.day, 30);
        const entryNoteSuffix = entryDate.day > 30 ? "（30 天制視為 30 號）" : "";
        workDays = 30 - (entryDay - 1);
        ratio = workDays / 30;
        note = `入職日 ${entryDay} 號${entryNoteSuffix} → 30 - (${entryDay} - 1) = ${workDays} 天`;
        summary.push(note);
        summary.push(`出勤比例：${workDays} / 30 = ${ratio.toFixed(2)}`);
        return { workDays, ratio, summary, note };
      }
      if (status === "exit") {
        if (!exitDate.isValid) {
          summary.push("請輸入正確的離職日期，以計算出勤比例。");
          return { workDays: 30, ratio: 1, summary, note: "離職日期未完成" };
        }
        const exitDay = Math.min(exitDate.day, 30);
        const exitNoteSuffix = exitDate.day > 30 ? "（30 天制視為 30 號）" : "";
        workDays = 30 - (30 - exitDay);
        ratio = workDays / 30;
        note = `離職日 ${exitDay} 號${exitNoteSuffix} → 30 - (30 - ${exitDay}) = ${workDays} 天`;
        summary.push(note);
        summary.push(`出勤比例：${workDays} / 30 = ${ratio.toFixed(2)}`);
        return { workDays, ratio, summary, note };
      }
      summary.push(note);
      return { workDays, ratio, summary, note };
    };

    /**
     * Determine health insurance billing rule for the month.
     * @param {"entry"|"active"|"exit"} status
     * @param {{day: number, isValid: boolean, hasValue: boolean}} exitDate
     * @returns {{isPayable: boolean, note: string}}
     */
    const getHealthCoverageInfo = (status, exitDate) => {
      if (status !== "exit") {
        return { isPayable: true, note: "投保當月按月全額計費" };
      }
      if (!exitDate.isValid) {
        return { isPayable: true, note: "離職日未完成，暫以全額計費" };
      }
      const exitMoment = dayjs(exitDate.value, "YYYY-MM-DD", true);
      if (!exitMoment.isValid()) {
        return { isPayable: true, note: "離職日格式未完成，暫以全額計費" };
      }
      const lastDay = exitMoment.endOf("month");
      const lastDayWeek = lastDay.day();
      let lastWorkingDay = lastDay;
      if (lastDayWeek === 6) {
        lastWorkingDay = lastDay.subtract(1, "day");
      } else if (lastDayWeek === 0) {
        lastWorkingDay = lastDay.subtract(2, "day");
      }
      const isPayable = exitMoment.isSame(lastWorkingDay, "day");
      if (isPayable) {
        return {
          isPayable: true,
          note: `離職日為當月最後工作日（${lastWorkingDay.format("MM/DD")}），健保照全月計費`
        };
      }
      return {
        isPayable: false,
        note: `當月最後工作日為 ${lastWorkingDay.format("MM/DD")}，離職日非最後工作日，退保當月免繳`
      };
    };

    /**
     * Find matching insurance grade by salary.
     * @param {number} salary
     * @param {Array<{code: string, min: number, max: number|null, insured: number}>} grades
     * @returns {{code: string, min: number, max: number|null, insured: number}|null}
     */
    const findGrade = (salary, grades) => {
      const value = Number(salary) || 0;
      if (value <= 0 || !grades?.length) {
        return null;
      }
      const match = grades.find((item) => value >= item.min && (item.max === null || value <= item.max));
      if (match) {
        return match;
      }
      const firstGrade = grades[0];
      const lastGrade = grades[grades.length - 1];
      if (firstGrade && value < firstGrade.min) {
        return firstGrade;
      }
      return lastGrade || null;
    };

    /**
     * Build salary calculation state based on form inputs.
     * @returns {object}
     */
    const buildCalculationState = () => {
      const employmentType = getEmploymentType();
      const baseResult = validateNumberField("baseSalaryInput", {
        required: true,
        min: 0,
        integer: true,
        label: employmentType === "hourly" ? "時薪" : "本薪"
      });
      const meal = validateNumberField("mealAllowanceInput", { min: 0, integer: true, label: "伙食費" });
      const supervisor = validateNumberField("supervisorAllowanceInput", { min: 0, integer: true, label: "主管津貼" });
      const professional = validateNumberField("professionalAllowanceInput", { min: 0, integer: true, label: "專業津貼" });
      const transport = validateNumberField("transportAllowanceInput", { min: 0, integer: true, label: "交通津貼" });
      const overtime134 = validateNumberField("overtimeHours134Input", { min: 0, step: 0.5, label: "加班 1.34 倍時數" });
      const overtime167 = validateNumberField("overtimeHours167Input", { min: 0, step: 0.5, label: "加班 1.67 倍時數" });
      const overtime200 = validateNumberField("overtimeHours200Input", { min: 0, step: 0.5, label: "加班 2.00 倍時數" });
      const dependents = validateNumberField("dependentsSelect", { min: 0, max: 3, integer: true, label: "眷屬數" });
      const status = getAttendanceStatus();
      const entryDate = validateDateField("entryDateInput", { required: status === "entry" });
      const exitDate = validateDateField("exitDateInput", { required: status === "exit" });

      const allowancesTotal = meal.value + supervisor.value + professional.value + transport.value;
      const baseHourlyRate = getHourlyRate(employmentType, baseResult.value);
      const baseMonthlyRaw = employmentType === "hourly"
        ? baseHourlyRate * 8 * 30
        : baseResult.value;
      const baseMonthlyTotal = baseMonthlyRaw + allowancesTotal;
      const attendanceInfo = calculateAttendanceInfo(status, entryDate, exitDate);
      const healthCoverageInfo = getHealthCoverageInfo(status, exitDate);
      const ratio = attendanceInfo.ratio;
      const insuranceDays = attendanceInfo.workDays;
      const coverageRatio = insuranceDays / 30;
      const adjustedSubtotal = baseMonthlyTotal * ratio;
      const overtimeHourlyRateRaw = Number.isFinite(baseMonthlyTotal / 240) ? baseMonthlyTotal / 240 : 0;
      const overtimeHourlyRateRounded = Math.ceil(overtimeHourlyRateRaw);
      const overtimeHourlyRateDiff = overtimeHourlyRateRounded - overtimeHourlyRateRaw;
      const overtimePay = calculateOvertimePay(
        overtimeHourlyRateRounded,
        overtime134.value,
        overtime167.value,
        overtime200.value
      );
      const overtimeHoursTotal = overtime134.value + overtime167.value + overtime200.value;
      const grossSalary = adjustedSubtotal + overtimePay;
      let totalWageValid = true;
      if (baseResult.isValid && grossSalary < config.minWage) {
        totalWageValid = false;
      }
      const insuredBasis = grossSalary;
      const laborGrade = findGrade(insuredBasis, laborGrades);
      const healthGrade = findGrade(insuredBasis, healthGrades);
      const laborInsuredSalary = laborGrade ? laborGrade.insured : 0;
      const healthInsuredSalary = healthGrade ? healthGrade.insured : 0;
      const laborTotal = laborInsuredSalary * config.laborRate * coverageRatio;
      const laborEmployee = Math.round(laborTotal * config.laborShare.employee);
      const laborEmployer = Math.round(laborTotal * config.laborShare.employer);
      const healthEmployeeMultiplier = 1 + (dependents.value || 0);
      const healthChargeRatio = healthCoverageInfo.isPayable ? 1 : 0;
      const healthEmployee = Math.round(
        healthInsuredSalary * config.healthRate * config.healthShare.employee * healthEmployeeMultiplier * healthChargeRatio
      );
      const healthEmployer = Math.round(
        healthInsuredSalary * config.healthRate * config.healthShare.employer * config.healthEmployerMultiplier * healthChargeRatio
      );
      const pensionEmployer = Math.round(grossSalary * config.pensionEmployerRate);
      const netSalary = grossSalary - laborEmployee - healthEmployee;
      const companyTotal = grossSalary + laborEmployer + healthEmployer + pensionEmployer;

      return {
        employmentType,
        baseSalary: baseResult.value,
        baseSalaryValid: baseResult.isValid && totalWageValid,
        baseMonthlyRaw,
        allowances: {
          meal: meal.value,
          supervisor: supervisor.value,
          professional: professional.value,
          transport: transport.value
        },
        allowancesTotal,
        overtimeHourlyRateRaw,
        overtimeHourlyRateRounded,
        overtimeHourlyRateDiff,
        overtimeHours134: overtime134.value,
        overtimeHours167: overtime167.value,
        overtimeHours200: overtime200.value,
        overtimeHoursTotal,
        overtimePay,
        attendanceInfo,
        healthCoverageInfo,
        ratio,
        insuranceDays,
        coverageRatio,
        grossSalary,
        insuredBasis,
        laborGrade,
        healthGrade,
        laborInsuredSalary,
        healthInsuredSalary,
        laborEmployee,
        laborEmployer,
        healthEmployee,
        healthEmployer,
        pensionEmployer,
        netSalary,
        companyTotal,
        dependents: dependents.value || 0
      };
    };

    /**
     * Render salary structure calculation process.
     * @param {object} state
     * @returns {void}
     */
    const renderSalaryStructure = (state) => {
      const container = document.getElementById("salaryProcess");
      if (!container) {
        return;
      }
      const allowanceLines = [
        `伙食費 ${formatCurrency(state.allowances.meal)}`,
        `主管津貼 ${formatCurrency(state.allowances.supervisor)}`,
        `專業津貼 ${formatCurrency(state.allowances.professional)}`,
        `交通津貼 ${formatCurrency(state.allowances.transport)}`
      ];
      const baseLabel = state.employmentType === "hourly"
        ? `時薪 ${formatCurrency(state.baseSalary)} × 8 × 30`
        : `本薪 ${formatCurrency(state.baseSalary)}`;
      const baseSummary = state.employmentType === "hourly"
        ? `${baseLabel} = ${formatCurrency(state.baseMonthlyRaw)}`
        : baseLabel;
      const ratioText = `${state.attendanceInfo.workDays} / 30 = ${state.ratio.toFixed(2)}`;
      const minWageNote = state.grossSalary < config.minWage
        ? `檢核：薪資總額不得低於基本工資 ${formatNumber(config.minWage)}（目前 ${formatCurrency(state.grossSalary)}）`
        : `檢核：薪資總額不得低於基本工資 ${formatNumber(config.minWage)}`;
      const minWageClass = state.grossSalary < config.minWage
        ? "calc-list__item calc-list__item--alert"
        : "calc-list__item calc-list__item--muted";
      container.innerHTML = `
        <ul class="calc-list">
          <li class="calc-list__item">${baseSummary}</li>
          <li class="calc-list__item">津貼合計：${allowanceLines.join(" + ")} = ${formatCurrency(state.allowancesTotal)}</li>
          <li class="calc-list__item">薪資基礎：${formatCurrency(state.baseMonthlyRaw)} + ${formatCurrency(state.allowancesTotal)} = ${formatCurrency(state.baseMonthlyRaw + state.allowancesTotal)}</li>
          <li class="calc-list__item">出勤比例：${ratioText}</li>
          <li class="calc-list__item">計薪基礎：(${formatCurrency(state.baseMonthlyRaw + state.allowancesTotal)}) × ${state.ratio.toFixed(2)} = ${formatCurrency((state.baseMonthlyRaw + state.allowancesTotal) * state.ratio)}</li>
          <li class="calc-list__item">工作總時數：8 小時 × 30 天 = 240</li>
          <li class="calc-list__item">時薪計算：薪資總額(不含加班、未按出勤比例) ${formatCurrency(state.baseMonthlyRaw + state.allowancesTotal)} ÷ 240 = ${formatDecimal(state.overtimeHourlyRateRaw)} 元/時 → 進位 ${formatNumber(state.overtimeHourlyRateRounded)} 元/時（差額 ${formatDecimal(state.overtimeHourlyRateDiff)} 元/時）</li>
          <li class="calc-list__item">加班費：(1.34 × ${formatHour(state.overtimeHours134)} + 1.67 × ${formatHour(state.overtimeHours167)} + 2.00 × ${formatHour(state.overtimeHours200)}) × ${formatNumber(state.overtimeHourlyRateRounded)} 元/時 = ${formatCurrency(state.overtimePay)}（合計 ${formatHour(state.overtimeHoursTotal)} 小時）</li>
          <li class="calc-list__item">薪資總額：${formatCurrency(state.grossSalary)}</li>
          <li class="${minWageClass}">${minWageNote}</li>
        </ul>
      `;
    };

    /**
     * Render attendance calculation process.
     * @param {object} state
     * @returns {void}
     */
    const renderAttendance = (state) => {
      const container = document.getElementById("attendanceProcess");
      if (!container) {
        return;
      }
      const listItems = state.attendanceInfo.summary.length
        ? state.attendanceInfo.summary.map((text) => `<li class="calc-list__item">${text}</li>`).join("")
        : `<li class="calc-list__item calc-list__item--muted">在職狀態，出勤比例固定 1.00</li>`;
      container.innerHTML = `
        <ul class="calc-list">
          <li class="calc-list__item">計薪月份：30 天制</li>
          ${listItems}
          <li class="calc-list__item">加班時數：1.34 × ${formatHour(state.overtimeHours134)}、1.67 × ${formatHour(state.overtimeHours167)}、2.00 × ${formatHour(state.overtimeHours200)}（合計 ${formatHour(state.overtimeHoursTotal)} 小時）</li>
        </ul>
      `;
    };

    /**
     * Render settlement details for employee and company.
     * @param {object} state
     * @returns {void}
     */
    const renderSettlement = (state) => {
      const employee = document.getElementById("employeePayslip");
      const company = document.getElementById("companyCost");
      const match = document.getElementById("insuranceMatch");
      const highlight = document.getElementById("netSalaryHighlight");
      if (!employee || !company || !match || !highlight) {
        return;
      }
      const laborCode = state.laborGrade ? state.laborGrade.code : "—";
      const healthCode = state.healthGrade ? state.healthGrade.code : "—";
      const laborRange = state.laborGrade ? formatRange(state.laborGrade.min, state.laborGrade.max) : "尚未匹配";
      const healthRange = state.healthGrade ? formatRange(state.healthGrade.min, state.healthGrade.max) : "尚未匹配";
      const laborRateText = formatPercent(config.laborRate, 1);
      const laborEmployeeShareText = formatPercent(config.laborShare.employee, 0);
      const laborEmployerShareText = formatPercent(config.laborShare.employer, 0);
      const healthRateText = formatPercent(config.healthRate, 2);
      const healthEmployeeShareText = formatPercent(config.healthShare.employee, 0);
      const healthEmployerShareText = formatPercent(config.healthShare.employer, 0);
      const healthEmployerMultiplierText = config.healthEmployerMultiplier.toFixed(2);
      const coverageText = `${state.insuranceDays} / 30`;
      const healthCoverageNote = state.healthCoverageInfo?.note || "投保當月按月全額計費";
      const healthEmployeeFormula = state.healthCoverageInfo?.isPayable
        ? `${healthRateText} × ${healthEmployeeShareText} × ${1 + state.dependents} 倍`
        : "退保當月免繳";
      const healthEmployerFormula = state.healthCoverageInfo?.isPayable
        ? `${healthRateText} × ${healthEmployerShareText} × ${healthEmployerMultiplierText}`
        : "退保當月免繳";
      highlight.textContent = `實領薪資：${formatCurrency(state.netSalary)}`;
      employee.innerHTML = `
        <div class="split-card">
          <div class="split-card__line"><span>應發薪資</span><span>${formatCurrency(state.grossSalary)}</span></div>
          <div class="split-card__line"><span>勞保扣款（${laborRateText} × ${laborEmployeeShareText} × ${coverageText}）</span><span>${formatCurrency(state.laborEmployee)}</span></div>
          <div class="split-card__line"><span>健保扣款（${healthEmployeeFormula}）</span><span>${formatCurrency(state.healthEmployee)}</span></div>
          <div class="split-card__line"><span>實領薪資</span><span>${formatCurrency(state.netSalary)}</span></div>
          <div class="split-card__note">勞保級距 ${laborCode}（${laborRange}｜投保薪資 ${formatCurrency(state.laborInsuredSalary)}）<br />健保級距 ${healthCode}（${healthRange}｜投保薪資 ${formatCurrency(state.healthInsuredSalary)}）</div>
        </div>
      `;
      company.innerHTML = `
        <div class="split-card">
          <div class="split-card__line"><span>應發薪資</span><span>${formatCurrency(state.grossSalary)}</span></div>
          <div class="split-card__line"><span>勞保雇主負擔（${laborRateText} × ${laborEmployerShareText} × ${coverageText}）</span><span>${formatCurrency(state.laborEmployer)}</span></div>
          <div class="split-card__line"><span>健保雇主負擔（${healthEmployerFormula}）</span><span>${formatCurrency(state.healthEmployer)}</span></div>
          <div class="split-card__line"><span>勞退雇主提繳（6%）</span><span>${formatCurrency(state.pensionEmployer)}</span></div>
          <div class="split-card__line"><span>公司總負擔</span><span>${formatCurrency(state.companyTotal)}</span></div>
          <div class="split-card__note">公司費用以應發薪資計算，不含政府負擔。</div>
        </div>
      `;
      match.innerHTML = `
        <div class="split-card">
          <div class="split-card__line"><span>投保薪資基礎</span><span>${formatCurrency(state.insuredBasis)}</span></div>
          <div class="split-card__line"><span>勞保級距</span><span>${laborCode}（${laborRange}）</span></div>
          <div class="split-card__line"><span>健保級距</span><span>${healthCode}（${healthRange}）</span></div>
          <div class="split-card__line"><span>健保計費</span><span>${healthCoverageNote}</span></div>
          <div class="split-card__line"><span>投保日數</span><span>${coverageText}</span></div>
        </div>
      `;
    };

    /**
     * Render insurance grade tables and highlight matching grades.
     * @param {object} state
     * @returns {void}
     */
    const renderGradeTables = (state) => {
      const laborBody = document.getElementById("laborGradeTableBody");
      const healthBody = document.getElementById("healthGradeTableBody");
      const dependentsChip = document.getElementById("dependentsChip");
      const insuranceDaysChip = document.getElementById("insuranceDaysChip");
      if (!laborBody || !healthBody || !dependentsChip || !insuranceDaysChip) {
        return;
      }
      dependentsChip.textContent = `健保倍數：1 + ${state.dependents} 人`;
      insuranceDaysChip.textContent = `勞保投保日數：${state.insuranceDays} / 30`;
      const healthEmployeeMultiplier = 1 + state.dependents;
      const healthChargeRatio = state.healthCoverageInfo?.isPayable ? 1 : 0;
      laborBody.innerHTML = laborGrades
        .map((grade) => {
          const laborTotal = grade.insured * config.laborRate * state.coverageRatio;
          const laborEmployee = Math.round(laborTotal * config.laborShare.employee);
          const laborEmployer = Math.round(laborTotal * config.laborShare.employer);
          const isActive = state.laborGrade && grade.code === state.laborGrade.code;
          return `
            <tr class="${isActive ? "grade-table__row--active" : ""}">
              <td>${grade.code}</td>
              <td>${formatRange(grade.min, grade.max)}</td>
              <td>${formatCurrency(grade.insured)}</td>
              <td>${formatCurrency(laborEmployee)} / ${formatCurrency(laborEmployer)}</td>
            </tr>
          `;
        })
        .join("");
      healthBody.innerHTML = healthGrades
        .map((grade) => {
          const healthEmployee = Math.round(
            grade.insured * config.healthRate * config.healthShare.employee * healthEmployeeMultiplier * healthChargeRatio
          );
          const healthEmployer = Math.round(
            grade.insured * config.healthRate * config.healthShare.employer * config.healthEmployerMultiplier * healthChargeRatio
          );
          const isActive = state.healthGrade && grade.code === state.healthGrade.code;
          return `
            <tr class="${isActive ? "grade-table__row--active" : ""}">
              <td>${grade.code}</td>
              <td>${formatRange(grade.min, grade.max)}</td>
              <td>${formatCurrency(grade.insured)}</td>
              <td>${formatCurrency(healthEmployee)} / ${formatCurrency(healthEmployer)}</td>
            </tr>
          `;
        })
        .join("");
    };

    /**
     * Update base salary label and hint based on employment type.
     * @returns {void}
     */
    const updateBaseSalaryLabel = () => {
      const label = document.getElementById("baseSalaryLabel");
      const hint = document.getElementById("baseSalaryHint");
      const employmentType = getEmploymentType();
      if (label) {
        label.textContent = employmentType === "hourly" ? "時薪" : "本薪";
      }
      if (hint) {
        hint.textContent = "作為薪資計算基礎";
      }
    };

    /**
     * Toggle attendance date fields by status.
     * @returns {void}
     */
    const toggleAttendanceFields = () => {
      const status = getAttendanceStatus();
      const entryField = document.getElementById("entryDateField");
      const exitField = document.getElementById("exitDateField");
      if (!entryField || !exitField) {
        return;
      }
      entryField.classList.toggle("is-hidden", status !== "entry");
      exitField.classList.toggle("is-hidden", status !== "exit");
    };

    /**
     * Update all calculations and UI.
     * @returns {void}
     */
    const updateCalculations = () => {
      updateBaseSalaryLabel();
      const state = buildCalculationState();
      renderSalaryStructure(state);
      renderAttendance(state);
      renderSettlement(state);
      renderGradeTables(state);
    };

    /**
     * Handle form input events.
     * @param {Event} event
     * @returns {void}
     */
    const handleInputChange = (event) => {
      const target = event.target;
      updateCalculations();
    };

    /**
     * Handle attendance status change.
     * @returns {void}
     */
    const handleAttendanceStatusChange = () => {
      toggleAttendanceFields();
      updateCalculations();
    };

    /**
     * Initialize page bindings.
     * @returns {void}
     */
    const init = () => {
      document.querySelectorAll("input, select, textarea").forEach((input) => {
        input.addEventListener("input", handleInputChange);
        input.addEventListener("blur", handleInputChange);
      });
      document.querySelectorAll("input[name=\"attendanceStatus\"]").forEach((input) => {
        input.addEventListener("change", handleAttendanceStatusChange);
      });
      toggleAttendanceFields();
      updateCalculations();
    };

    /**
     * Handle DOM ready event.
     * @returns {void}
     */
    const handleDomReady = () => {
      init();
    };

    document.addEventListener("DOMContentLoaded", handleDomReady);
  </script>
</body>
</html>
