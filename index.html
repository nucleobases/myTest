<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Subscription Portal</title>
  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;background:#f4f6f8;color:#0f172a}
    .container{max-width:920px;margin:0 auto;padding:40px}
    .header{position:fixed;top:0;left:0;right:0;height:60px;background:#ffffff;color:#0f172a;display:flex;align-items:center;justify-content:space-between;padding:0 24px;box-shadow:0 3px 12px rgba(0,0,0,.08);z-index:20}
    .header .title{font-size:20px;font-weight:600;letter-spacing:.5px}
    .header .actions .btn{background:#22b07d;color:#ffffff;border:0;border-radius:8px;height:40px;padding:0 20px;cursor:pointer;font-weight:600;font-size:14px;transition:background .2s;display:inline-flex;align-items:center;gap:8px}
    .header .actions .btn:hover{background:#1a9a61}
    .hero{margin-top:100px}
    .card{background:#ffffff;border:1px solid #e2e8f0;border-radius:16px;padding:32px;box-shadow:0 8px 24px rgba(0,0,0,.12)}
    .center{display:flex;align-items:center;justify-content:center}
    .section-title{font-size:22px;font-weight:700;margin-bottom:24px;color:#22b07d;display:flex;align-items:center;gap:8px}
    .input{width:100%;max-width:360px;height:44px;border:1px solid #cbd5e1;border-radius:8px;padding:0 14px;font-size:15px;background:#ffffff;color:#0f172a;display:block}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;background:#22b07d;color:#ffffff;border:0;border-radius:12px;height:44px;padding:0 22px;font-weight:700;font-size:15px;cursor:pointer;transition:background .2s}
    .btn.secondary{background:#10b981;color:#ffffff}
    .btn.warn{background:#ef4444;color:#ffffff}
    .btn.ghost{background:#ffffff;color:#0f172a;border:1px solid #cbd5e1}
    .btn:disabled{opacity:.4;cursor:not-allowed}
    .desc{margin-top:12px;color:#64748b;font-size:14px}
    .hidden{display:none}
    .modal-mask{position:fixed;inset:0;background:rgba(17,24,39,.35);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{background:#ffffff;border-radius:14px;min-width:380px;max-width:92vw;border:1px solid #e2e8f0;box-shadow:0 12px 32px rgba(0,0,0,.16)}
    .modal .modal-body{padding:24px;color:#0f172a}
    .modal .modal-title{font-weight:800;margin-bottom:12px;color:#22b07d;font-size:18px;display:flex;align-items:center;gap:8px}
    .modal .modal-actions{display:flex;justify-content:flex-end;gap:16px;padding:16px;border-top:1px solid #e2e8f0;background:#f9fafb;border-bottom-left-radius:14px;border-bottom-right-radius:14px}
    .actions-row{display:flex;justify-content:flex-end;gap:16px;width:100%}
    #modal_msg{display:grid;gap:12px;width:100%}
    .modal .modal-form{display:grid;gap:12px;width:100%}
    .modal .input{width:100%;max-width:100%;min-width:0}
    .tabs{display:flex;gap:8px;border-bottom:2px solid #e2e8f0;margin-bottom:20px}
    .tab{padding:12px 20px;border:1px solid #e2e8f0;border-bottom:0;border-top-left-radius:10px;border-top-right-radius:10px;background:#f9fafb;color:#64748b;cursor:pointer;font-weight:600;transition:background .2s,color .2s;display:inline-flex;align-items:center;gap:8px}
    .tab.active{background:#ffffff;color:#22b07d;border-color:#10b981}
    .select{height:40px;border:1px solid #cbd5e1;border-radius:8px;padding:0 10px;background:#ffffff;color:#0f172a;font-size:14px;appearance:none;outline:none;cursor:pointer}
    .form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:24px}
    .kv{display:flex;flex-direction:column}
    .kv label{font-size:14px;font-weight:600;color:#64748b;margin-bottom:6px}
    .info{font-size:14px;color:#0f172a;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:10px;padding:10px 12px}
    .table{width:100%;border-collapse:separate;border-spacing:0;font-size:14px;border:1px solid #e2e8f0;border-radius:12px;overflow:hidden;background:#ffffff}
    .table thead th{background:#f9fafb;text-align:left;padding:12px 16px;border-bottom:1px solid #e2e8f0;color:#64748b;font-weight:700}
    .table tbody td{padding:12px 16px;border-bottom:1px solid #eef2f7;vertical-align:middle;color:#0f172a}
    .table tbody tr:last-child td{border-bottom:0}
    .inline{display:inline-flex;gap:16px;align-items:center}
    .badge{display:inline-block;background:#10b981;color:#ffffff;border:1px solid #0d805f;border-radius:999px;padding:4px 12px;font-size:12px;font-weight:800}
    .grid-features{display:grid;grid-template-columns:repeat(2,minmax(320px,1fr));gap:10px}
    .feat-row{display:flex;align-items:center;gap:10px}
    .checkbox{display:flex;align-items:center;gap:8px}
    .feat-meta{display:inline-flex;align-items:center;gap:8px}
    .toolbar{display:flex;gap:16px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;border:1px solid #cbd5e1;border-radius:999px;background:#f9fafb;color:#0f172a;font-size:13px}
    .chip input{margin:0}
  </style>
</head>
<body>
  <div class="header">
    <div class="title">Subscription Portal</div>
    <div class="actions">
      <button id="btn_login_open" class="btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 12c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4Z" stroke="#fff" stroke-width="2"/><path d="M4 20v-1c0-2.8 2.2-5 5-5h6c2.8 0 5 2.2 5 5v1" stroke="#fff" stroke-width="2"/></svg>
        Login
      </button>
    </div>
  </div>

  <div id="view_public" class="container hero">
    <div class="card center" style="flex-direction:column;gap:24px">
      <div class="section-title">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3v12M7 10l5 5 5-5M5 21h14" stroke="#22b07d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Download Trial License
      </div>
      <input id="email_input" class="input" type="email" placeholder="Enter your email">
      <button id="btn_trial" class="btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 10l5 5 5-5M12 3v12M5 21h14" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Download License
      </button>
      <div class="desc">Enter your email to start a 30-day trial.</div>
      <div class="badge">Public Mode</div>
    </div>
  </div>

  <div id="view_console" class="container hero hidden">
    <div class="card" style="padding:32px 32px 40px 32px">
      <div class="tabs">
        <div class="tab active" data-tab="gen">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z" stroke="#64748b" stroke-width="2"/><path d="M8 12h8M8 8h8M8 16h6" stroke="#64748b" stroke-width="2" stroke-linecap="round"/></svg>
          Generate
        </div>
        <div class="tab" data-tab="scan">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 5h18M6 10h12M6 15h12M3 19h18" stroke="#64748b" stroke-width="2" stroke-linecap="round"/></svg>
          Scan Unused
        </div>
      </div>

      <div id="tab_gen">
        <div class="form-grid">
          <div class="kv">
            <label>License Type</label>
            <select id="sel_type" class="select">
              <option value="Bonus">Bonus</option>
              <option value="Trial">Trial</option>
            </select>
          </div>
          <div class="kv" style="grid-column:1/-1">
            <div id="gen_days_info" class="info hidden">License expiration in 90 days.</div>
          </div>
          <div class="kv" style="grid-column:1/-1">
            <label>Features</label>
            <div id="gen_features" class="grid-features"></div>
          </div>
        </div>
        <div style="margin-top:24px;text-align:right">
          <button id="btn_generate_download" class="btn secondary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 10l5 5 5-5M12 3v12M5 21h14" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Download
          </button>
        </div>
      </div>

      <div id="tab_scan" class="hidden">
        <div class="toolbar">
          <div class="inline" id="filter_types">
            <label class="chip"><input type="checkbox" value="Base"> Base</label>
            <label class="chip"><input type="checkbox" value="Bonus" checked> Bonus</label>
            <label class="chip"><input type="checkbox" value="Trial" checked> Trial</label>
          </div>
          <div class="inline">
            <span style="font-weight:600;color:#64748b">Filter by expiration</span>
            <select id="filter_days" class="select">
              <option value="90">90</option>
              <option value="360">360</option>
              <option value="720">720</option>
              <option value="1080">1080</option>
            </select>
          </div>
        </div>

        <table class="table" id="table_unused">
          <thead>
            <tr>
              <th>Profile ID</th>
              <th>Name</th>
              <th>OEM</th>
              <th>Card Type</th>
              <th>Created At</th>
              <th>Pending</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="modal_mask" class="modal-mask">
    <div class="modal">
      <div class="modal-body">
        <div class="modal-title" id="modal_title">Message</div>
        <div id="modal_msg"></div>
      </div>
      <div class="modal-actions" id="modal_actions"></div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    function license_init(){
      $("#btn_login_open").on("click",function(){license_login_open()})
      $("#btn_trial").on("click",function(){license_trial_download()})
      $(".tab").on("click",function(){license_tab_switch($(this).data("tab"))})
      $("#btn_generate_download").on("click",function(){license_generate_download()})
      license_seed_unused()
      license_init_gen_features()
      $("#sel_type").on("change",function(){license_on_type_change()})
      $("#filter_types input, #filter_days").on("change",function(){license_apply_scan_filters()})
      license_on_type_change()
      return true
    }

    function license_seed_unused(){
      var rows=[
        {id:"803a9012-ac30-4bcb-8c01-ddd76aa03bb7",name:"Test Profile3",oem:"Qsss",type:"Bonus",days:360,ts:"2025-10-31 15:22:55",pending:2},
        {id:"e243d0f4-6b96-488a-897d-77c07bb59615",name:"Test Profile1",oem:"Qsss",type:"Base",days:720,ts:"2025-10-31 16:00:57",pending:3},
        {id:"bbd0dd57-ea6c-49b8-a1a7-0f6b78609ab8",name:"Gamma Pilot",oem:"Qsss",type:"Bonus",days:1080,ts:"2025-10-31 16:01:00",pending:2},
        {id:"4f2b9d3a-9f88-4b93-a0a5-2c12b7b9d921",name:"Alpha Eval",oem:"Qsss",type:"Trial",days:90,ts:"2025-10-30 10:12:08",pending:1},
        {id:"9a1e7b02-27c8-41da-9f17-5d4e3f2b77a1",name:"Beta Lab",oem:"Qsss",type:"Base",days:360,ts:"2025-10-29 09:01:22",pending:4},
        {id:"a1111111-1111-1111-1111-111111111111",name:"Delta PoC",oem:"Qsss",type:"Trial",days:90,ts:"2025-10-28 11:05:30",pending:2},
        {id:"b2222222-2222-2222-2222-222222222222",name:"Epsilon QA",oem:"Qsss",type:"Bonus",days:720,ts:"2025-10-27 14:42:10",pending:3},
        {id:"c3333333-3333-3333-3333-333333333333",name:"Zeta Staging",oem:"Qsss",type:"Base",days:1080,ts:"2025-10-26 08:20:49",pending:2},
        {id:"d4444444-4444-4444-4444-444444444444",name:"Eta Sandbox",oem:"Qsss",type:"Bonus",days:360,ts:"2025-10-25 17:33:11",pending:5},
        {id:"e5555555-5555-5555-5555-555555555555",name:"Theta UAT",oem:"Qsss",type:"Trial",days:90,ts:"2025-10-24 09:12:02",pending:1},
        {id:"f6666666-6666-6666-6666-666666666666",name:"Iota Field",oem:"Qsss",type:"Base",days:720,ts:"2025-10-23 12:47:55",pending:3},
        {id:"g7777777-7777-7777-7777-777777777777",name:"Kappa Demo",oem:"Qsss",type:"Bonus",days:1080,ts:"2025-10-22 15:29:41",pending:4}
      ]
      var tbody=$("#table_unused tbody")
      tbody.empty()
      for(var i=0;i<rows.length;i++){
        var r=rows[i]
        var tr=$("<tr></tr>").attr("data-type",r.type).attr("data-days",r.days)
        tr.append($("<td></td>").text(r.id))
        tr.append($("<td></td>").text(r.name))
        tr.append($("<td></td>").text(r.oem))
        tr.append($("<td></td>").text(r.type))
        tr.append($("<td></td>").text(r.ts))
        tr.append($("<td></td>").text(r.pending))
        var btn=$('<button class="btn warn" type="button">Delete</button>').on("click",function(){license_scan_delete_row(this)})
        tr.append($("<td></td>").append(btn))
        tbody.append(tr)
      }
      license_apply_scan_filters()
      return true
    }

    function license_apply_scan_filters(){
      var types=[]
      $("#filter_types input:checked").each(function(){types.push($(this).val())})
      var day=$("#filter_days").val()
      $("#table_unused tbody tr").each(function(){
        var okType=types.indexOf($(this).attr("data-type"))!==-1
        var okDay=String($(this).attr("data-days"))===String(day)
        if(okType && okDay){$(this).show()}else{$(this).hide()}
      })
      return true
    }

    function license_login_open(){
      var form=$('<div class="modal-form"></div>')
      form.append($('<input type="text" id="login_user" class="input" placeholder="Username">'))
      form.append($('<input type="password" id="login_pass" class="input" placeholder="Password">'))
      var cancel=$('<button class="btn ghost" type="button">Cancel</button>')
      var ok=$('<button class="btn secondary" type="button">OK</button>')
      cancel.on("click",function(){license_hide_modal()})
      ok.on("click",function(){license_login_submit()})
      var actions=$('<div class="actions-row"></div>').append(cancel).append(ok)
      license_show_modal("Login",form,actions)
      return true
    }

    function license_login_submit(){
      license_hide_modal()
      license_switch_view("console")
      return true
    }

    function license_switch_view(view){
      if(view==="console"){
        $("#view_public").addClass("hidden")
        $("#view_console").removeClass("hidden")
      } else {
        $("#view_console").addClass("hidden")
        $("#view_public").removeClass("hidden")
      }
      return true
    }

    function license_tab_switch(tab){
      $(".tab").removeClass("active")
      if(tab==="gen"){
        $('.tab[data-tab="gen"]').addClass("active")
        $("#tab_gen").removeClass("hidden")
        $("#tab_scan").addClass("hidden")
      } else {
        $('.tab[data-tab="scan"]').addClass("active")
        $("#tab_scan").removeClass("hidden")
        $("#tab_gen").addClass("hidden")
      }
      return true
    }

    function license_validate_email(v){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)}

    function license_trial_download(){
      var email=$("#email_input").val().trim()
      if(!license_validate_email(email)){license_alert("Please enter a valid email");return false}
      var wrap=$('<div style="display:grid;gap:12px"></div>')
      wrap.append($('<div style="font-weight:600"></div>').text("Select trial features (up to 2):"))
      var grid=$('<div class="grid-features"></div>')
      for(var i=1;i<=8;i++){
        var id="trial_feat_"+i
        var item=$('<label class="checkbox"></label>')
        item.append($('<input type="checkbox" class="trial-feature">').attr("id",id).attr("value","Feature"+i))
        item.append($('<span></span>').text("Feature"+i))
        grid.append(item)
      }
      wrap.append(grid)
      wrap.on("change",".trial-feature",function(){
        var cnt=wrap.find(".trial-feature:checked").length
        if(cnt>2){$(this).prop("checked",false);license_alert("Trial allows up to 2 features")}
      })
      var cancel=$('<button class="btn ghost" type="button">Cancel</button>')
      var ok=$('<button class="btn secondary" type="button">Start Download</button>')
      cancel.on("click",function(){license_hide_modal()})
      ok.on("click",function(){
        license_hide_modal()
        var msg=$('<div style="display:grid;gap:8px"></div>')
        msg.append($('<div></div>').text("30-Day Trial License downloaded"))
        msg.append($('<div style="color:#64748b;font-size:13px"></div>').text("Email: "+email))
        var close=$('<button class="btn ghost" type="button">Close</button>').on("click",function(){license_hide_modal()})
        var ok2=$('<button class="btn secondary" type="button">OK</button>').on("click",function(){license_hide_modal()})
        var actions2=$('<div class="actions-row"></div>').append(close).append(ok2)
        license_show_modal("Completed",msg,actions2)
      })
      var actions=$('<div class="actions-row"></div>').append(cancel).append(ok)
      license_show_modal("Trial Features",wrap,actions)
      return true
    }

    function license_init_gen_features(){
      var box=$("#gen_features");box.empty()
      for(var i=1;i<=12;i++){
        var id="gen_feat_"+i
        var row=$('<div class="feat-row"></div>')
        var label=$('<label class="checkbox"></label>')
        var cb=$('<input type="checkbox" class="gen-feature">').attr("id",id).attr("value","Feature"+i)
        var text=$('<span></span>').text("Feature"+i)
        label.append(cb).append(text)

        var meta=$('<div class="feat-meta hidden"></div>')
        var metaText=$('<span class="feat-meta-text">Expiration in</span>')
        var dd=$('<select class="select feat-days"></select>')
        dd.append('<option value="30">30 days</option>')
        dd.append('<option value="60">60 days</option>')
        dd.append('<option value="90">90 days</option>')
        dd.append('<option value="360">360 days</option>')
        meta.append(metaText).append(dd)

        row.append(label).append(meta)
        box.append(row)
      }
      $(".gen-feature").on("change",function(){
        var type=$("#sel_type").val()
        var row=$(this).closest(".feat-row")
        if(type==="Trial"){
          var checked=$(".gen-feature:checked").length
          if(checked>2){$(this).prop("checked",false);license_alert("Trial allows up to 2 features")}
          row.find(".feat-meta").addClass("hidden")
        }else{
          row.find(".feat-meta").toggleClass("hidden",!$(this).is(":checked"))
        }
      })
      return true
    }

    function license_on_type_change(){
      var t=$("#sel_type").val()
      if(t==="Trial"){
        $("#gen_days_info").removeClass("hidden")
        $(".feat-meta").addClass("hidden")
        enforce_trial_cap()
      }else{
        $("#gen_days_info").addClass("hidden")
        $(".feat-row").each(function(){
          var cb=$(this).find(".gen-feature")
          $(this).find(".feat-meta").toggleClass("hidden",!cb.is(":checked"))
        })
      }
      return true
    }

    function enforce_trial_cap(){
      var checked=$(".gen-feature:checked")
      if(checked.length>2){checked.slice(2).prop("checked",false)}
      return true
    }

    function license_generate_download(){
      var t=$("#sel_type").val()
      if(t==="Trial"){
        var feats=[]
        $(".gen-feature:checked").each(function(){feats.push($(this).val())})
        if(feats.length===0){license_alert("Select at least one feature");return false}
        if(feats.length>2){license_alert("Trial allows up to 2 features");return false}
        var list=$('<div style="display:grid;gap:6px"></div>')
        list.append($('<div></div>').text("Type: Trial"))
        list.append($('<div></div>').text("License expiration in 90 days."))
        list.append($('<div></div>').text("Features: "+feats.join(", ")))
        var wrap=$('<div style="display:grid;gap:12px"></div>')
        wrap.append($('<div style="font-weight:600"></div>').text("Downloading…"))
        wrap.append(list)
        var close=$('<button class="btn ghost" type="button">Close</button>').on("click",function(){license_hide_modal()})
        var ok=$('<button class="btn secondary" type="button">OK</button>').on("click",function(){license_hide_modal()})
        var actions=$('<div class="actions-row"></div>').append(close).append(ok)
        license_show_modal("Message",wrap,actions);return true
      }else{
        var items=[]
        $(".feat-row").each(function(){
          var cb=$(this).find(".gen-feature")
          if(cb.is(":checked")){
            var name=cb.val()
            var days=$(this).find(".feat-days").val()
            items.push(name+" ("+days+" days)")
          }
        })
        if(items.length===0){license_alert("Select at least one feature");return false}
        var list=$('<div style="display:grid;gap:6px"></div>')
        list.append($('<div></div>').text("Type: Bonus"))
        list.append($('<div></div>').text("Features: "+items.join(", ")))
        var wrap=$('<div style="display:grid;gap:12px"></div>')
        wrap.append($('<div style="font-weight:600"></div>').text("Downloading…"))
        wrap.append(list)
        var close=$('<button class="btn ghost" type="button">Close</button>').on("click",function(){license_hide_modal()})
        var ok=$('<button class="btn secondary" type="button">OK</button>').on("click",function(){license_hide_modal()})
        var actions=$('<div class="actions-row"></div>').append(close).append(ok)
        license_show_modal("Message",wrap,actions);return true
      }
    }

    function license_scan_delete_row(btn){
      var tr=$(btn).closest("tr"),id=tr.children().eq(0).text()
      var msg=$('<div></div>').text("Are you sure you want to delete "+id+" ?")
      var cancel=$('<button class="btn ghost" type="button">Cancel</button>')
      var ok=$('<button class="btn warn" type="button">Delete</button>')
      cancel.on("click",function(){license_hide_modal()})
      ok.on("click",function(){tr.remove();license_hide_modal()})
      var actions=$('<div class="actions-row"></div>').append(cancel).append(ok)
      license_show_modal("Confirm Deletion",msg,actions);return true
    }

    function license_alert(text){
      var msg=$('<div></div>').text(text)
      var close=$('<button class="btn ghost" type="button">Close</button>').on("click",function(){license_hide_modal()})
      var ok=$('<button class="btn secondary" type="button">OK</button>').on("click",function(){license_hide_modal()})
      var actions=$('<div class="actions-row"></div>').append(close).append(ok)
      license_show_modal("Alert",msg,actions);return true
    }

    function license_show_modal(title,content,actions){
      $("#modal_title").text(title)
      $("#modal_msg").empty().append(content)
      $("#modal_actions").empty().append(actions)
      $("#modal_mask").css("display","flex");return true
    }
    function license_hide_modal(){
      $("#modal_mask").css("display","none")
      $("#modal_title").text("");$("#modal_msg").empty();$("#modal_actions").empty();return true
    }
    $(function(){license_init()})
  </script>
</body>
</html>
